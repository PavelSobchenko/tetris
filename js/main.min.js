var app=app||{};!function(){app.const={WIDTH:216,HEIGHT:280,CELL:8,SPEED_START:5,SPEED_MAX:45,SPEED_STEP:10,SIZE_FIGURE:4,STROKE_STYLE:"#3b6cba",FILL_STYLE:"#1464e5"}}();var app=app||{};!function(){"use strict";app.classes=app.classes||{},app.classes.helper={}}();var app=app||{};!function(){"use strict";app.CellModel=Backbone.Model.extend({defaults:{x:0,y:0,left:!1,right:!1}})}();var app=app||{};!function(){"use strict";app.FigureCollection=Backbone.Collection.extend({model:app.CellModel,initialize:function(){var t=app.const.CELL,e=app.const.WIDTH/2-t/2;this.figure=[[{x:e-2*t,y:0-t,left:!0},{x:e-t,y:0-t},{x:e,y:0-t},{x:e+t,y:0-t,right:!0}],[{x:e-t,y:0-t},{x:e,y:0-t},{x:e-t,y:0},{x:e,y:0}],[{x:e,y:-(2*t)},{x:e,y:-t},{x:e,y:0},{x:e+t,y:0}],[{x:e,y:0-t},{x:e-t,y:0-2*t},{x:e,y:0-2*t},{x:e+t,y:0-2*t}]]},createFigure:function(t){this.reset(this.figure[t])}})}();var app=app||{};!function(){"use strict";app.CanvasView=Backbone.View.extend({el:"#cnvs",initialize:function(){this.el.style.border="1px solid #333",this.el.height=app.const.HEIGHT,this.el.width=app.const.WIDTH,this.ctx=this.el.getContext("2d"),this.setCtx(),this.speed=app.const.SPEED_START,this.cellRect=app.const.CELL,this.statePlaying=null,this.blockMoveDown=!1,this.CC=new app.FigureCollection,this.FC=new app.FigureCollection,app.eventDispatcher.on("startPlay",this.startLoop,this),$(window).on("keyup",this.keyUpController.bind(this)),$(window).on("keydown",this.keyDownController.bind(this))},render:function(){this.statePlaying&&(this.moveFigure(),this.draw(),this.check())},setCtx:function(t){t?(this.ctx.fillStyle=t.fill_style||app.const.FILL_STYLE,this.ctx.strokeStyle=t.stroke_style||app.const.STROKE_STYLE):(this.ctx.fillStyle=app.const.FILL_STYLE,this.ctx.strokeStyle=app.const.STROKE_STYLE)},keyDownController:function(t){if(this.statePlaying)switch(t.keyCode){case 37:this.blockMoveDown=!0,this.moveFigure("left");break;case 39:this.blockMoveDown=!0,this.moveFigure("right");break;case 40:this.speed<app.const.SPEED_MAX&&(this.speed+=app.const.SPEED_STEP,this.play())}},keyUpController:function(t){if(this.statePlaying){var e=t.ctrlKey;e&&(81==t.keyCode&&(this.endLoop(),this.startLoop()),88==t.keyCode&&this.gameOver()),40==t.keyCode&&(this.speed=app.const.SPEED_START,this.play()),37!=t.keyCode&&39!=t.keyCode||(this.blockMoveDown=!1)}},gameOver:function(){this.stop(),this.statePlaying=null,app.eventDispatcher.trigger("gameover"),console.log("gameover")},checkLeft:function(){var t=this.CC.findWhere({left:!0}),e=this.FC.findWhere({x:t.get("x")-this.cellRect,y:t.get("y")});return 0!=t.get("x")&&!e},checkRight:function(){var t=this.CC.findWhere({right:!0}),e=this.FC.findWhere({x:t.get("x")+this.cellRect,y:t.get("y")});return t.get("x")+this.cellRect!=app.const.WIDTH&&!e},check:function(){var t=!0;this.CC.find(function(e){if(e.get("y")+this.cellRect==app.const.HEIGHT)return t=!1,e}.bind(this)),t||(this.endLoop(),this.startLoop()),this.CC.find(function(e){var i=e.get("x"),s=e.get("y")+this.cellRect;if(this.FC.findWhere({x:i,y:s}))return t=!1,e}.bind(this)),t||(this.endLoop(),this.CC.find(function(t){return 0==t.get("y")})?this.gameOver():this.startLoop())},startLoop:function(){this.CC.createFigure(0),this.play()},endLoop:function(){this.CC.each(function(t){this.FC.add(t)}.bind(this))},moveFigure:function(t){"left"==t?this.checkLeft()?this.CC.each(function(t){t.set("x",t.get("x")-app.const.CELL)}.bind(this)):this.blockMoveDown=!1:"right"==t?this.checkRight()?this.CC.each(function(t){t.set("x",t.get("x")+app.const.CELL)}.bind(this)):this.blockMoveDown=!1:this.blockMoveDown||this.CC.each(function(t){t.set("y",t.get("y")+app.const.CELL)})},moveFigureDown:function(){this.CC.each(function(t){t.set("y",t.get("y")+app.const.CELL)})},play:function(){this.playId&&this.stop(),this.playId=setInterval(this.render.bind(this),1e3/this.speed),this.statePlaying="play"},stop:function(){clearInterval(this.playId)},draw:function(){this.clear(),this.drawFigures()},drawFigures:function(){this.CC.each(this.drawCell,this),this.FC.each(this.drawCell,this)},drawCell:function(t){var e=t.get("x"),i=t.get("y");this.ctx.strokeRect(e,i,this.cellRect-.5,this.cellRect-.5),this.ctx.fillRect(e,i,this.cellRect-2,this.cellRect-2)},clear:function(){this.ctx.clearRect(0,0,app.const.WIDTH,app.const.HEIGHT)}})}();var app=app||{};!function(){"use strict";var t=Backbone.View.extend({el:"#page",initialize:function(){app.views={},app.models={},app.collections={},app.eventDispatcher=_.extend({},Backbone.Events),app.views.canvas=new app.CanvasView,this.startPlay()},startPlay:function(){app.eventDispatcher.trigger("startPlay")}});$(document).ready(function(){app.page=new t})}();
//# sourceMappingURL=main.min.js.map
