{"version":3,"sources":["Constants.js","Helper.js","Cell.js","FigureCollection.js","Canvas.js","Page.js"],"names":["app","const","WIDTH","HEIGHT","CELL","SPEED_START","SPEED_MAX","SPEED_STEP","SIZE_FIGURE","STROKE_STYLE","FILL_STYLE","classes","helper","CellModel","Backbone","Model","extend","defaults","x","y","left","right","FigureCollection","Collection","model","initialize","r","c","this","figure","createFigure","intg","reset","CanvasView","View","el","style","border","height","width","ctx","getContext","setCtx","speed","cellRect","statePlaying","CC","FC","eventDispatcher","on","startLoop","$","window","keyUpController","bind","keyDownController","render","moveFigure","draw","check","settingObj","fillStyle","fill_style","strokeStyle","stroke_style","e","keyCode","play","ctrl","ctrlKey","endLoop","gameOver","stop","trigger","console","log","checkLeft","cell","findWhere","fillCell","get","checkRight","cont","find","each","add","direct","set","playId","setInterval","clearInterval","clear","drawFigures","drawCell","strokeRect","fillRect","clearRect","Page","views","models","collections","_","Events","canvas","startPlay","document","ready","page"],"mappings":"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","file":"main.min.js","sourcesContent":["var app = app || {};\n\n(function () {\n    app.const = {\n        // canvas\n        WIDTH: 216,\n        HEIGHT: 280,\n        CELL: 8,\n        SPEED_START: 5,\n        SPEED_MAX: 45,\n        SPEED_STEP: 10,\n        SIZE_FIGURE: 4,\n        STROKE_STYLE: '#3b6cba',\n        FILL_STYLE: '#1464e5'\n    };\n})();","var app = app || {};\n\n(function () {\n    \"use strict\";\n    \n    app.classes = app.classes || {}; \n    \n    app.classes.helper = {\n        \n    };\n})();","var app = app || {};\n\n(function () {\n    'use strict';\n    app.CellModel = Backbone.Model.extend({\n        defaults: {\n            x: 0,\n            y: 0,\n            left: false,\n            right: false\n        }\n    });\n})();","var app = app || {};\n\n(function () {\n    \"use strict\";\n    app.FigureCollection = Backbone.Collection.extend({\n        model: app.CellModel,\n        initialize: function () {\n            var r = app.const.CELL, c = (app.const.WIDTH/2)-(r/2);\n            this.figure = [\n                [{x:(c-(r*2)), y:0-r, left: true}, {x:(c-r), y:0-r}, {x:c, y:0-r}, {x:(c+r), y:0-r, right: true}], // row\n                [{x:(c-r),y:0-r}, {x:c,y:0-r}, {x:(c-r),y:0}, {x:c,y:0}], // rect\n                [{x:c,y:-(r*2)}, {x:c,y:-r}, {x:c,y:0}, {x:(c+r),y:0}], // L\n                [{x:c,y:0-r}, {x:(c-r),y:0-(r*2)}, {x:c,y:0-(r*2)}, {x:(c+r),y:0-(r*2)}] // T\n            ]\n        },\n        createFigure: function (intg) {\n            this.reset(this.figure[intg]);\n        }\n    });\n})();","var app = app || {};\n\n(function () {\n    \"use strict\";\n    app.CanvasView = Backbone.View.extend({\n        el: '#cnvs',\n        initialize: function () {\n            this.el.style.border = '1px solid #333';\n            this.el.height = app.const.HEIGHT;\n            this.el.width = app.const.WIDTH;\n\n            this.ctx = this.el.getContext(\"2d\");\n            this.setCtx();\n\n            this.speed = app.const.SPEED_START;\n            this.cellRect = app.const.CELL;\n            this.statePlaying = null;\n            this.CC = new app.FigureCollection(); // current figure\n            this.FC = new app.FigureCollection(); // array of filled cells\n\n            app.eventDispatcher.on('startPlay', this.startLoop, this);\n            $(window).on('keyup', this.keyUpController.bind(this));\n            $(window).on('keydown', this.keyDownController.bind(this));\n        },\n        render: function () {\n            if(!this.statePlaying)\n                return;\n\n            this.moveFigure();\n            this.draw();\n            this.check();\n        },\n\n        // set func\n        setCtx: function (settingObj) {\n            if(settingObj) {\n                this.ctx.fillStyle = settingObj.fill_style || app.const.FILL_STYLE;\n                this.ctx.strokeStyle = settingObj.stroke_style || app.const.STROKE_STYLE;\n            } else {\n                this.ctx.fillStyle = app.const.FILL_STYLE;\n                this.ctx.strokeStyle = app.const.STROKE_STYLE;\n            }\n        },\n        keyDownController: function (e) {\n            if(!this.statePlaying)\n                return;\n\n            switch (e.keyCode) {\n                case 37:\n                    this.moveFigure('left');\n                    break;\n                case 39:\n                    this.moveFigure('right');\n                    break;\n                case 40:\n                    if(this.speed < app.const.SPEED_MAX) {\n                        this.speed += app.const.SPEED_STEP;\n                        this.play();\n                    }\n                    break;\n            }\n        },\n        keyUpController: function (e) {\n            if(!this.statePlaying)\n                return;\n\n            var ctrl = e.ctrlKey;\n            if(ctrl) { // develop helpers\n                if(e.keyCode == 81) { // Q\n                    this.endLoop();\n                    this.startLoop();\n                }\n                if(e.keyCode == 88) { // X\n                    this.gameOver();\n                }\n            }\n            if(e.keyCode == 40) {\n                this.speed = app.const.SPEED_START;\n                this.play();\n            }\n        },\n        gameOver: function () {\n            this.stop();\n            this.statePlaying = null;\n            app.eventDispatcher.trigger('gameover');\n            console.log('gameover');\n        },\n\n        checkLeft: function () {\n            var cell = this.CC.findWhere({left: true});\n            var fillCell = this.FC.findWhere({\n                x: cell.get('x')-this.cellRect,\n                y: cell.get('y')\n            });\n\n            if(cell.get('x') == 0 || fillCell)\n                return false;\n\n            return true;\n        },\n        checkRight: function () {\n            var cell = this.CC.findWhere({right: true});\n            var fillCell = this.FC.findWhere({\n                x: cell.get('x')+this.cellRect,\n                y: cell.get('y')\n            });\n\n            if(cell.get('x')+this.cellRect == app.const.WIDTH || fillCell)\n                return false;\n\n            return true;\n        },\n        // DATA func\n        check: function () {\n            var cont = true; // continue?\n\n            // check for bottom border\n            this.CC.find(function (cell) {\n                if(cell.get('y')+this.cellRect == app.const.HEIGHT) {\n                    cont = false;\n                    return cell;\n                }\n            }.bind(this));\n\n            if(!cont) {\n                this.endLoop();\n                this.startLoop();\n            }\n\n            // check for fill cells\n            this.CC.find(function (cell) {\n                var x = cell.get('x'), y = cell.get('y')+this.cellRect;\n\n                if(this.FC.findWhere({x: x, y: y})) {\n                    cont = false;\n                    return cell;\n                }\n            }.bind(this));\n\n            if(!cont) {\n                this.endLoop();\n                // check for gameover\n                if(this.CC.find(function (cell) { return cell.get('y') == 0; })) {\n                    this.gameOver();\n                } else {\n                    this.startLoop();\n                }\n            }\n        },\n        startLoop: function () {\n            this.CC.createFigure(0);\n            this.play();\n        },\n        endLoop: function () {\n            this.CC.each(function (cell) {\n                this.FC.add(cell);\n            }.bind(this));\n        },\n        moveFigure: function (direct) {\n            if(direct == 'left' && this.checkLeft()) {\n                this.CC.each(function (cell) {\n                    cell.set('x', cell.get('x')-(app.const.CELL));\n                }.bind(this));\n            } else if(direct == 'right' && this.checkRight()) {\n                this.CC.each(function (cell) {\n                    cell.set('x', cell.get('x')+(app.const.CELL));\n                }.bind(this));\n            }\n            else {\n                this.CC.each(function (cell) {\n                    cell.set('y', cell.get('y')+(app.const.CELL));\n                });\n            }\n        },\n        play: function () {\n            if(this.playId)\n                this.stop();\n            this.playId = setInterval(this.render.bind(this), 1000 / this.speed);\n            this.statePlaying = 'play'\n        },\n        stop: function () {\n            clearInterval(this.playId);\n        },\n\n        // Render func\n        draw: function () {\n            this.clear();\n            this.drawFigures();\n        },\n        drawFigures: function () {\n            this.CC.each(this.drawCell, this);\n            this.FC.each(this.drawCell, this);\n        },\n        drawCell: function (cell) {\n            var x = cell.get('x'),\n                y = cell.get('y');\n\n            this.ctx.strokeRect(x, y, this.cellRect-0.5, this.cellRect-0.5);\n            this.ctx.fillRect(x, y, this.cellRect-2, this.cellRect-2);\n        },\n        clear: function () {\n            this.ctx.clearRect(0,0, app.const.WIDTH, app.const.HEIGHT);\n        }\n    });\n})();","var app = app || {};\n\n(function () {\n    \"use strict\";\n    var Page = Backbone.View.extend({\n        el: '#page',\n\n        initialize: function () {\n            app.views = {};\n            app.models = {};\n            app.collections = {};\n            app.eventDispatcher = _.extend({}, Backbone.Events );\n\n            app.views.canvas = new app.CanvasView();\n\n            this.startPlay();\n        },\n        startPlay: function () {\n            app.eventDispatcher.trigger('startPlay');\n        }\n    });\n\n    $(document).ready(function () {\n        app.page = new Page();\n    });\n})();"]}