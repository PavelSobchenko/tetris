{"version":3,"sources":["Constants.js","Helper.js","Cell.js","FigureCollection.js","Canvas.js","Page.js"],"names":["app","const","WIDTH","HEIGHT","CELL","SPEED_START","SPEED_MAX","SPEED_STEP","SIZE_FIGURE","STROKE_STYLE","FILL_STYLE","classes","helper","CellModel","Backbone","Model","extend","defaults","x","y","left","right","FigureCollection","Collection","model","initialize","r","c","this","figure","createFigure","intg","reset","CanvasView","View","el","style","border","height","width","ctx","getContext","setCtx","speed","cellRect","statePlaying","blockMoveDown","CC","FC","eventDispatcher","on","startLoop","$","window","keyUpController","bind","keyDownController","render","moveFigure","draw","check","settingObj","fillStyle","fill_style","strokeStyle","stroke_style","e","keyCode","play","ctrl","ctrlKey","endLoop","gameOver","stop","trigger","console","log","checkLeft","cell","findWhere","fillCell","get","checkRight","cont","find","each","add","direct","set","moveFigureDown","playId","setInterval","clearInterval","clear","drawFigures","drawCell","strokeRect","fillRect","clearRect","Page","views","models","collections","_","Events","canvas","startPlay","document","ready","page"],"mappings":"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","file":"main.min.js","sourcesContent":["var app = app || {};\n\n(function () {\n    app.const = {\n        // canvas\n        WIDTH: 216,\n        HEIGHT: 280,\n        CELL: 8,\n        SPEED_START: 5,\n        SPEED_MAX: 45,\n        SPEED_STEP: 10,\n        SIZE_FIGURE: 4,\n        STROKE_STYLE: '#3b6cba',\n        FILL_STYLE: '#1464e5'\n    };\n})();","var app = app || {};\n\n(function () {\n    \"use strict\";\n    \n    app.classes = app.classes || {}; \n    \n    app.classes.helper = {\n        \n    };\n})();","var app = app || {};\n\n(function () {\n    'use strict';\n    app.CellModel = Backbone.Model.extend({\n        defaults: {\n            x: 0,\n            y: 0,\n            left: false,\n            right: false\n        }\n    });\n})();","var app = app || {};\n\n(function () {\n    \"use strict\";\n    app.FigureCollection = Backbone.Collection.extend({\n        model: app.CellModel,\n        initialize: function () {\n            var r = app.const.CELL, c = (app.const.WIDTH/2)-(r/2);\n            this.figure = [\n                [{x:(c-(r*2)), y:0-r, left: true}, {x:(c-r), y:0-r}, {x:c, y:0-r}, {x:(c+r), y:0-r, right: true}], // row\n                [{x:(c-r),y:0-r}, {x:c,y:0-r}, {x:(c-r),y:0}, {x:c,y:0}], // rect\n                [{x:c,y:-(r*2)}, {x:c,y:-r}, {x:c,y:0}, {x:(c+r),y:0}], // L\n                [{x:c,y:0-r}, {x:(c-r),y:0-(r*2)}, {x:c,y:0-(r*2)}, {x:(c+r),y:0-(r*2)}] // T\n            ]\n        },\n        createFigure: function (intg) {\n            this.reset(this.figure[intg]);\n        }\n    });\n})();","var app = app || {};\n\n(function () {\n    \"use strict\";\n    app.CanvasView = Backbone.View.extend({\n        el: '#cnvs',\n        initialize: function () {\n            this.el.style.border = '1px solid #333';\n            this.el.height = app.const.HEIGHT;\n            this.el.width = app.const.WIDTH;\n\n            this.ctx = this.el.getContext(\"2d\");\n            this.setCtx();\n\n            this.speed = app.const.SPEED_START;\n            this.cellRect = app.const.CELL;\n            this.statePlaying = null;\n            this.blockMoveDown = false;\n            this.CC = new app.FigureCollection(); // current figure\n            this.FC = new app.FigureCollection(); // array of filled cells\n\n            app.eventDispatcher.on('startPlay', this.startLoop, this);\n            $(window).on('keyup', this.keyUpController.bind(this));\n            $(window).on('keydown', this.keyDownController.bind(this));\n        },\n        render: function () {\n            if(!this.statePlaying)\n                return;\n\n            this.moveFigure();\n            this.draw();\n            this.check();\n        },\n\n        // set func\n        setCtx: function (settingObj) {\n            if(settingObj) {\n                this.ctx.fillStyle = settingObj.fill_style || app.const.FILL_STYLE;\n                this.ctx.strokeStyle = settingObj.stroke_style || app.const.STROKE_STYLE;\n            } else {\n                this.ctx.fillStyle = app.const.FILL_STYLE;\n                this.ctx.strokeStyle = app.const.STROKE_STYLE;\n            }\n        },\n        keyDownController: function (e) {\n            if(!this.statePlaying)\n                return;\n\n            switch (e.keyCode) {\n                case 37:\n                    this.blockMoveDown = true;\n                    this.moveFigure('left');\n                    break;\n                case 39:\n                    this.blockMoveDown = true;\n                    this.moveFigure('right');\n                    break;\n                case 40:\n                    if(this.speed < app.const.SPEED_MAX) {\n                        this.speed += app.const.SPEED_STEP;\n                        this.play();\n                    }\n                    break;\n            }\n        },\n        keyUpController: function (e) {\n            if(!this.statePlaying)\n                return;\n\n            var ctrl = e.ctrlKey;\n            if(ctrl) { // develop helpers\n                if(e.keyCode == 81) { // Q\n                    this.endLoop();\n                    this.startLoop();\n                }\n                if(e.keyCode == 88) { // X\n                    this.gameOver();\n                }\n            }\n            if(e.keyCode == 40) {\n                this.speed = app.const.SPEED_START;\n                this.play();\n            }\n            if(e.keyCode == 37 || e.keyCode == 39)\n                this.blockMoveDown = false;\n        },\n        gameOver: function () {\n            this.stop();\n            this.statePlaying = null;\n            app.eventDispatcher.trigger('gameover');\n            console.log('gameover');\n        },\n\n        checkLeft: function () {\n            var cell = this.CC.findWhere({left: true});\n            var fillCell = this.FC.findWhere({\n                x: cell.get('x')-this.cellRect,\n                y: cell.get('y')\n            });\n\n            if(cell.get('x') == 0 || fillCell)\n                return false;\n\n            return true;\n        },\n        checkRight: function () {\n            var cell = this.CC.findWhere({right: true});\n            var fillCell = this.FC.findWhere({\n                x: cell.get('x')+this.cellRect,\n                y: cell.get('y')\n            });\n\n            if(cell.get('x')+this.cellRect == app.const.WIDTH || fillCell)\n                return false;\n\n            return true;\n        },\n        // DATA func\n        check: function () {\n            var cont = true; // continue?\n\n            // check for bottom border\n            this.CC.find(function (cell) {\n                if(cell.get('y')+this.cellRect == app.const.HEIGHT) {\n                    cont = false;\n                    return cell;\n                }\n            }.bind(this));\n\n            if(!cont) {\n                this.endLoop();\n                this.startLoop();\n            }\n\n            // check for fill cells\n            this.CC.find(function (cell) {\n                var x = cell.get('x'), y = cell.get('y')+this.cellRect;\n\n                if(this.FC.findWhere({x: x, y: y})) {\n                    cont = false;\n                    return cell;\n                }\n            }.bind(this));\n\n            if(!cont) {\n                this.endLoop();\n                // check for gameover\n                if(this.CC.find(function (cell) { return cell.get('y') == 0; })) {\n                    this.gameOver();\n                } else {\n                    this.startLoop();\n                }\n            }\n        },\n        startLoop: function () {\n            this.CC.createFigure(0);\n            this.play();\n        },\n        endLoop: function () {\n            this.CC.each(function (cell) {\n                this.FC.add(cell);\n            }.bind(this));\n        },\n        moveFigure: function (direct) {\n            if(direct == 'left') {\n                if(this.checkLeft()) {\n                    this.CC.each(function (cell) {\n                        cell.set('x', cell.get('x')-(app.const.CELL));\n                    }.bind(this));\n                } else\n                    this.blockMoveDown = false; // unblock keydown event\n            } else if(direct == 'right') {\n                if(this.checkRight()) {\n                    this.CC.each(function (cell) {\n                        cell.set('x', cell.get('x')+(app.const.CELL));\n                    }.bind(this));\n                } else\n                    this.blockMoveDown = false;\n            }\n            else if(!this.blockMoveDown) {\n                this.CC.each(function (cell) {\n                    cell.set('y', cell.get('y')+(app.const.CELL));\n                });\n            }\n        },\n        moveFigureDown: function () {\n            this.CC.each(function (cell) {\n                cell.set('y', cell.get('y')+(app.const.CELL));\n            });\n        },\n        play: function () {\n            if(this.playId)\n                this.stop();\n            this.playId = setInterval(this.render.bind(this), 1000 / this.speed);\n            this.statePlaying = 'play'\n        },\n        stop: function () {\n            clearInterval(this.playId);\n        },\n\n        // Render func\n        draw: function () {\n            this.clear();\n            this.drawFigures();\n        },\n        drawFigures: function () {\n            this.CC.each(this.drawCell, this);\n            this.FC.each(this.drawCell, this);\n        },\n        drawCell: function (cell) {\n            var x = cell.get('x'),\n                y = cell.get('y');\n\n            this.ctx.strokeRect(x, y, this.cellRect-0.5, this.cellRect-0.5);\n            this.ctx.fillRect(x, y, this.cellRect-2, this.cellRect-2);\n        },\n        clear: function () {\n            this.ctx.clearRect(0,0, app.const.WIDTH, app.const.HEIGHT);\n        }\n    });\n})();","var app = app || {};\n\n(function () {\n    \"use strict\";\n    var Page = Backbone.View.extend({\n        el: '#page',\n\n        initialize: function () {\n            app.views = {};\n            app.models = {};\n            app.collections = {};\n            app.eventDispatcher = _.extend({}, Backbone.Events );\n\n            app.views.canvas = new app.CanvasView();\n\n            this.startPlay();\n        },\n        startPlay: function () {\n            app.eventDispatcher.trigger('startPlay');\n        }\n    });\n\n    $(document).ready(function () {\n        app.page = new Page();\n    });\n})();"]}